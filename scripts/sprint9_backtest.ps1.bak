param(
  [string]$Freq = '5min'
)
$ErrorActionPreference = 'Stop'
$ROOT = (Get-Location).Path
$Py = Join-Path $ROOT '.venv/Scripts/python.exe'
$Script = Join-Path $ROOT 'scripts/sprint9_backtest.py'

function Info($m){ $ts=(Get-Date).ToUniversalTime().ToString('s')+'Z'; Write-Host "[$ts] [BT9] $m" }

if(-not (Test-Path $Py)){ throw "Python venv nicht gefunden: $Py" }
if(-not (Test-Path $Script)){ throw "Nicht gefunden: $Script" }
Info "Start Backtest | freq=$Freq"
& $Py $Script --freq $Freq
if($LASTEXITCODE -ne 0){ throw "Backtest fehlgeschlagen" }

$OUT = Join-Path $ROOT 'output'
$curve = Join-Path $OUT "equity_curve_${Freq}.csv"
$rep   = Join-Path $OUT 'performance_report.md'
if(Test-Path $curve){ Info "[OK] Equity Curve: $curve" }
if(Test-Path $rep){   Info "[OK] Report:       $rep" }
Info "DONE"
