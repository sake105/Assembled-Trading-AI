#!/usr/bin/env python
# -*- coding: utf-8 -*-
import argparse
from pathlib import Path
import pandas as pd
import matplotlib.pyplot as plt

ROOT = Path(__file__).resolve().parents[1]
OUT  = ROOT / "output"

def main():
    ap = argparse.ArgumentParser()
    ap.add_argument("--freq", default="5min", choices=["1min","5min","15min"])
    args = ap.parse_args()

    curve = pd.read_csv(OUT / f"equity_curve_{args.freq}.csv", parse_dates=["timestamp"])
    perf  = (OUT / "performance_report.md").read_text(encoding="utf-8")

    # Plot
    fig = plt.figure(figsize=(10,4))
    plt.plot(curve["timestamp"], curve["equity"], label="Equity (with costs)")
    plt.title(f"Equity Curve ({args.freq})")
    plt.xlabel("Time")
    plt.ylabel("PnL")
    plt.tight_layout()
    png = OUT / f"equity_curve_{args.freq}.png"
    fig.savefig(png, dpi=140)
    plt.close(fig)

    # console summary
    print("[PLOT] written:", png)
    for line in perf.splitlines():
        if line.strip().startswith(("- PF:", "- Sharpe:", "- Trades:")):
            print("[SUMMARY]", line.strip())

if __name__ == "__main__":
    main()
